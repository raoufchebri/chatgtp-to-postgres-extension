# gpt2pg

This chrome extension allows developers to quickly generate and test SQL queries on a Postgres database using ChatGPT, a powerful language model developed by OpenAI.

## Features
Extract SQL queries generated by ChatGPT and send them to a Node.js API
Connect the API to a global database cache service (PolyScale) to reduce the risk of query abuse and improve performance
Display query results in a table on the ChatGPT page
## Prerequisites
- A Neon account
- A PolyScale account (optional)
- Vercel CLI

## Installation
1. Clone the repository to your local machine
2. Run npm install to install the necessary dependencies
3. Run npm run build to build the extension
4. Go to chrome://extensions/ in your chrome browser
5. Turn on developer mode
6. Click on "Load unpacked"
7. Select the "dist" folder in your local repository

## Usage
- Open chat.openai.com
- Generate SQL queries using ChatGPT
- Click on the "Run SQL" button below the query to send the query to the API
- Query results will be displayed in a table on the ChatGPT page

## API
The API is a simple Node.js function deployed to Vercel. The following packages are required:

- `pg`
- `dotenv`
Create a new folder and Node.js app by running the following commands on your terminal:
```bash
npm init
npm install pg dotenv
```
Create a api/handler.js and paste the following code:

```javascript
const { Pool } = require('pg');
require('dotenv').config();

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
});

exports.handler = async (event) => {
  const { sql, chatId } = JSON.parse(event.body);
  const schema = `chat_${chatId}`;
  const client = await pool.connect();
  try {
    await client.query(`SET search_path TO ${schema}`);
    const { rows } = await client.query(sql);
    return {
      statusCode: 200,
      body: JSON.stringify(rows),
    };
  } catch (err) {
    return {
      statusCode: 500,
      body: JSON.stringify({ error: err.message }),
    };
  } finally {
    client.release();
  }
};

```

Note that the DATABASE_URL is the one provided by PolyScale when you connect it to your Neon database.
